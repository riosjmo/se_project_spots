!function(){"use strict";var e="",t=e+"2fc47fd8e9a9bcd9612f.jpg",r=e+"40608da7369d39bc1077.svg",n=e+"d38272e02bb4f1ab1c37.svg",o=e+"d3610e9c6dce3cb370d8.svg",a=e+"dba18798529f242c4c6d.svg";function s(e,t,r="Save",n="Saving..."){e.textContent=t?n:r}const c={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-btn",inactiveButtonClass:"modal__submit-btn_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error"},d=(e,t,r)=>{e.querySelector(`#${t.id}-error`).textContent="",t.classList.remove(r.inputErrorClass)},l=(e,t,r)=>{(e=>e.some(e=>!e.validity.valid))(e)?i(t,r):(t.disabled=!1,t.classList.remove(r.inactiveButtonClass))},i=(e,t)=>{e.disabled=!0,e.classList.add(t.inactiveButtonClass)},u=(e,t,r)=>{t.forEach(t=>{d(e,t,r)})},m=document.getElementById("profile-avatar");m.src=t,document.getElementById("add-card-close-btn").src=a,document.getElementById("edit-card-close-btn").src=a,document.getElementById("pencil-icon").src=n,document.getElementById("plus-icon").src=r,document.getElementById("header-logo").src=o;const _=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)})}addNewCard({name:e,link:t}){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then(this._checkResponse)}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}updateAvatar(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify(e)}).then(this._checkResponse)}editUserInfo({name:e,about:t}){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}changeLikeStatus(e,t){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:t?"DELETE":"PUT",headers:this._headers}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"229fe7f5-1dd5-4b37-9746-c0081404e2a7","Content-Type":"application/json"}});let h="";_.getAppInfo().then(([e,t])=>{h=t._id,e.forEach(e=>{const t=K(e);M.append(t)}),m.src=t.avatar,b.textContent=t.name,p.textContent=t.about}).catch(console.error);const v=document.querySelector(".profile__edit-btn"),y=document.querySelector(".profile__add-btn"),f=document.querySelector(".profile__avatar-btn"),b=document.querySelector(".profile__name"),p=document.querySelector(".profile__description"),S=document.querySelector("#edit-modal"),E=S.querySelector(".modal__form"),k=S.querySelector(".modal__close-btn"),q=S.querySelector("#profile-name-input"),L=S.querySelector("#profile-description-input"),g=document.querySelector(".modal__close-btn_type_preview"),C=document.querySelector("#add-card-modal"),$=C.querySelector(".modal__form"),U=C.querySelector(".modal__submit-btn"),j=C.querySelector(".modal__close-btn"),I=C.querySelector("#add-card-name-input"),x=C.querySelector("#add-card-link-input"),B=document.querySelector("#avatar-modal"),P=B.querySelector(".modal__form"),A=B.querySelector(".modal__submit-btn"),D=B.querySelector(".modal__close-btn"),w=B.querySelector("#profile-avatar-input"),T=document.querySelector("#delete-modal"),N=T.querySelector("#delete-form"),O=T.querySelector(".modal__cancel-btn"),J=document.querySelector("#preview-modal"),R=document.querySelector(".modal__image"),H=document.querySelector(".modal__caption"),z=document.querySelector("#card-template"),M=document.querySelector(".cards__list");let F,G;function K(e){const t=z.content.querySelector(".card").cloneNode(!0),r=t.querySelector(".card__title"),n=t.querySelector(".card__image"),o=t.querySelector(".card__like-btn"),a=t.querySelector(".card__delete-btn");return e.isLiked&&o.classList.add("card__like-btn_liked"),r.textContent=e.name,n.src=e.link,n.alt=e.name,o.addEventListener("click",t=>function(e,t){const r=e.target,n=r.classList.contains("card__like-btn_liked");_.changeLikeStatus(t,n).then(e=>{e.isLiked?r.classList.add("card__like-btn_liked"):r.classList.remove("card__like-btn_liked")}).catch(console.error)}(t,e._id)),n.addEventListener("click",()=>{Q(J),R.src=e.link,H.textContent=e.name}),a.addEventListener("click",()=>{!function(e,t){F=e,G=t,Q(T)}(t,e._id)}),t}function Q(e){e.classList.add("modal_opened"),document.body.classList.add("modal-open"),document.addEventListener("keydown",W)}function V(e){e.classList.remove("modal_opened"),document.body.classList.remove("modal-open"),document.removeEventListener("keydown",W)}function W(e){if("Escape"===e.key){const e=document.querySelector(".modal.modal_opened");e&&V(e)}}var X;v.addEventListener("click",()=>{q.value=b.textContent,L.value=p.textContent,u(E,[q,L],c),Q(S)}),y.addEventListener("click",()=>{u($,[I,x],c),Q(C)}),O.addEventListener("click",()=>{V(T)}),k.addEventListener("click",()=>{V(S)}),g.addEventListener("click",()=>{V(J)}),j.addEventListener("click",()=>{V(C)}),f.addEventListener("click",()=>{Q(B)}),D.addEventListener("click",()=>{u(P,[w],c),V(B)}),P.addEventListener("submit",function(e){e.preventDefault();const t=e.submitter;s(t,!0),_.updateAvatar({avatar:w.value}).then(t=>{m.src=t.avatar,e.target.reset(),i(A,c),V(B)}).catch(console.error).finally(()=>{s(t,!1)})}),N.addEventListener("submit",function(e){e.preventDefault();const t=e.submitter;s(t,!0,"Delete","Deleting..."),_.deleteCard(G).then(()=>{F.remove(),V(T)}).catch(console.error).finally(()=>{s(t,!1,"Delete","Deleting...")})}),E.addEventListener("submit",function(e){e.preventDefault();const t=e.submitter;s(t,!0),_.editUserInfo({name:q.value,about:L.value}).then(e=>{b.textContent=e.name,p.textContent=e.about,V(S)}).catch(console.error).finally(()=>{s(t,!1)})}),$.addEventListener("submit",function(e){e.preventDefault();const t=e.submitter;s(t,!0);const r=I.value,n=x.value;_.addNewCard({name:r,link:n}).then(e=>{const t=K(e);M.prepend(t),$.reset(),i(U,c),V(C)}).catch(console.error).finally(()=>{s(t,!1)})}),document.querySelectorAll(".modal").forEach(e=>{e.addEventListener("mousedown",t=>{t.target===e&&(e.classList.remove("modal_opened"),V(e))})}),X=c,document.querySelectorAll(X.formSelector).forEach(e=>{((e,t)=>{const r=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);l(r,n,t),e.addEventListener("reset",()=>{i(n,t)}),r.forEach(o=>{o.addEventListener("input",function(){((e,t,r)=>{t.validity.valid?d(e,t,r):((e,t,r,n)=>{e.querySelector(`#${t.id}-error`).textContent=r,t.classList.add(n.inputErrorClass)})(e,t,t.validationMessage,r)})(e,o,t),l(r,n,t)})})})(e,X)})}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFjQyxJQUMvQkEsRUFBSUUsU0FBV08sSUFDakJBLEVBQU14SCxVQUFVQyxPQUFPLGdCQUN2QnlILEVBQVdGLFFEdFJnQjNILEVDb1NoQlYsRURuU0U2QixTQUFTcUgsaUJBQWlCeEksRUFBT1QsY0FDekMwQixRQUFTbkIsSUFwQk0ySSxFQUFDM0ksRUFBUUUsS0FDakMsTUFBTU0sRUFBWW9JLE1BQU1DLEtBQUs3SSxFQUFPMEksaUJBQWlCeEksRUFBT1IsZ0JBQ3REb0osRUFBZ0I5SSxFQUFPRyxjQUFjRCxFQUFPUCxzQkFFbERZLEVBQWtCQyxFQUFXc0ksRUFBZTVJLEdBRTVDRixFQUFPbUgsaUJBQWlCLFFBQVMsS0FDL0JwRyxFQUFjK0gsRUFBZTVJLEtBRy9CTSxFQUFVVyxRQUFTNEgsSUFDakJBLEVBQWE1QixpQkFBaUIsUUFBUyxXQTdDaEI2QixFQUFDaEosRUFBUUMsRUFBU0MsS0FDdENELEVBQVFXLFNBQVNDLE1BR3BCZCxFQUFlQyxFQUFRQyxFQUFTQyxHQWhCYitJLEVBQUNqSixFQUFRQyxFQUFTaUosRUFBVWhKLEtBQzlCRixFQUFPRyxjQUFjLElBQUlGLEVBQVFHLFlBQ3pDYixZQUFjMkosRUFDekJqSixFQUFRSSxVQUFVWSxJQUFJZixFQUFPTCxrQkFXM0JvSixDQUFlakosRUFBUUMsRUFBU0EsRUFBUWtKLGtCQUFtQmpKLElBNEN6RDhJLENBQW1CaEosRUFBUStJLEVBQWM3SSxHQUN6Q0ssRUFBa0JDLEVBQVdzSSxFQUFlNUksRUFDOUMsTUFPQXlJLENBQWtCM0ksRUFBUUUsSSIsInNvdXJjZXMiOlsid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy93ZWJwYWNrL3J1bnRpbWUvcHVibGljUGF0aCIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3V0aWxzL2hlbHBlcnMuanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy9zY3JpcHRzL3ZhbGlkYXRpb24uanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3V0aWxzL0FwaS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBUaGUgcmVxdWlyZSBzY29wZVxudmFyIF9fd2VicGFja19yZXF1aXJlX18gPSB7fTtcblxuIiwiX193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjsiLCJleHBvcnQgZnVuY3Rpb24gc2V0QnV0dG9uVGV4dChcbiAgYnRuLFxuICBpc0xvYWRpbmcsXG4gIGRlZmF1bHRUZXh0ID0gXCJTYXZlXCIsXG4gIGxvYWRpbmdUZXh0ID0gXCJTYXZpbmcuLi5cIlxuKSB7XG4gIGlmIChpc0xvYWRpbmcpIHtcbiAgICBidG4udGV4dENvbnRlbnQgPSBsb2FkaW5nVGV4dDtcbiAgfSBlbHNlIHtcbiAgICBidG4udGV4dENvbnRlbnQgPSBkZWZhdWx0VGV4dDtcbiAgfVxufVxuIiwiZXhwb3J0IGNvbnN0IHZhbGlkYXRpb25Db25maWcgPSB7XG4gIGZvcm1TZWxlY3RvcjogXCIubW9kYWxfX2Zvcm1cIixcbiAgaW5wdXRTZWxlY3RvcjogXCIubW9kYWxfX2lucHV0XCIsXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fc3VibWl0LWJ0blwiLFxuICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcIm1vZGFsX19zdWJtaXQtYnRuX2Rpc2FibGVkXCIsXG4gIGlucHV0RXJyb3JDbGFzczogXCJtb2RhbF9faW5wdXRfdHlwZV9lcnJvclwiLFxuICBlcnJvckNsYXNzOiBcIm1vZGFsX19lcnJvclwiLFxufTtcblxuY29uc3Qgc2hvd0lucHV0RXJyb3IgPSAoZm9ybUVsLCBpbnB1dEVsLCBlcnJvck1zZywgY29uZmlnKSA9PiB7XG4gIGNvbnN0IGVycm9yTXNnRWwgPSBmb3JtRWwucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFbC5pZH0tZXJyb3JgKTtcbiAgZXJyb3JNc2dFbC50ZXh0Q29udGVudCA9IGVycm9yTXNnO1xuICBpbnB1dEVsLmNsYXNzTGlzdC5hZGQoY29uZmlnLmlucHV0RXJyb3JDbGFzcyk7XG59O1xuXG5jb25zdCBoaWRlSW5wdXRFcnJvciA9IChmb3JtRWwsIGlucHV0RWwsIGNvbmZpZykgPT4ge1xuICBjb25zdCBlcnJvck1zZ0VsID0gZm9ybUVsLnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0RWwuaWR9LWVycm9yYCk7XG4gIGVycm9yTXNnRWwudGV4dENvbnRlbnQgPSBcIlwiO1xuICBpbnB1dEVsLmNsYXNzTGlzdC5yZW1vdmUoY29uZmlnLmlucHV0RXJyb3JDbGFzcyk7XG59O1xuXG5jb25zdCBjaGVja0lucHV0VmFsaWRpdHkgPSAoZm9ybUVsLCBpbnB1dEVsLCBjb25maWcpID0+IHtcbiAgaWYgKCFpbnB1dEVsLnZhbGlkaXR5LnZhbGlkKSB7XG4gICAgc2hvd0lucHV0RXJyb3IoZm9ybUVsLCBpbnB1dEVsLCBpbnB1dEVsLnZhbGlkYXRpb25NZXNzYWdlLCBjb25maWcpO1xuICB9IGVsc2Uge1xuICAgIGhpZGVJbnB1dEVycm9yKGZvcm1FbCwgaW5wdXRFbCwgY29uZmlnKTtcbiAgfVxufTtcblxuY29uc3QgaGFzSW52YWxpZElucHV0ID0gKGlucHV0TGlzdCkgPT4ge1xuICByZXR1cm4gaW5wdXRMaXN0LnNvbWUoKGlucHV0KSA9PiB7XG4gICAgcmV0dXJuICFpbnB1dC52YWxpZGl0eS52YWxpZDtcbiAgfSk7XG59O1xuXG5jb25zdCB0b2dnbGVCdXR0b25TdGF0ZSA9IChpbnB1dExpc3QsIGJ1dHRvbkVsLCBjb25maWcpID0+IHtcbiAgaWYgKGhhc0ludmFsaWRJbnB1dChpbnB1dExpc3QsIGNvbmZpZykpIHtcbiAgICBkaXNhYmxlQnV0dG9uKGJ1dHRvbkVsLCBjb25maWcpO1xuICB9IGVsc2Uge1xuICAgIGJ1dHRvbkVsLmRpc2FibGVkID0gZmFsc2U7XG4gICAgYnV0dG9uRWwuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCBkaXNhYmxlQnV0dG9uID0gKGJ1dHRvbkVsLCBjb25maWcpID0+IHtcbiAgYnV0dG9uRWwuZGlzYWJsZWQgPSB0cnVlO1xuICBidXR0b25FbC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbn07XG5cbmV4cG9ydCBjb25zdCByZXNldFZhbGlkYXRpb24gPSAoZm9ybUVsLCBpbnB1dExpc3QsIGNvbmZpZykgPT4ge1xuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWwsIGlucHV0LCBjb25maWcpO1xuICB9KTtcbn07XG5cbmNvbnN0IHNldEV2ZW50TGlzdGVuZXJzID0gKGZvcm1FbCwgY29uZmlnKSA9PiB7XG4gIGNvbnN0IGlucHV0TGlzdCA9IEFycmF5LmZyb20oZm9ybUVsLnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmlucHV0U2VsZWN0b3IpKTtcbiAgY29uc3QgYnV0dG9uRWxlbWVudCA9IGZvcm1FbC5xdWVyeVNlbGVjdG9yKGNvbmZpZy5zdWJtaXRCdXR0b25TZWxlY3Rvcik7XG5cbiAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBjb25maWcpO1xuXG4gIGZvcm1FbC5hZGRFdmVudExpc3RlbmVyKFwicmVzZXRcIiwgKCkgPT4ge1xuICAgIGRpc2FibGVCdXR0b24oYnV0dG9uRWxlbWVudCwgY29uZmlnKTtcbiAgfSk7XG5cbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xuICAgIGlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgY2hlY2tJbnB1dFZhbGlkaXR5KGZvcm1FbCwgaW5wdXRFbGVtZW50LCBjb25maWcpO1xuICAgICAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBjb25maWcpO1xuICAgIH0pO1xuICB9KTtcbn07XG5cbmV4cG9ydCBjb25zdCBlbmFibGVWYWxpZGF0aW9uID0gKGNvbmZpZykgPT4ge1xuICBjb25zdCBmb3JtTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmZvcm1TZWxlY3Rvcik7XG4gIGZvcm1MaXN0LmZvckVhY2goKGZvcm1FbCkgPT4ge1xuICAgIHNldEV2ZW50TGlzdGVuZXJzKGZvcm1FbCwgY29uZmlnKTtcbiAgfSk7XG59O1xuIiwiaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcbmltcG9ydCBhdmF0YXJTcmMgZnJvbSBcIi4uL2ltYWdlcy9hdmF0YXIuanBnXCI7XG5pbXBvcnQgcGx1c0ljb24gZnJvbSBcIi4uL2ltYWdlcy9wbHVzLnN2Z1wiO1xuaW1wb3J0IHBlbmNpbEljb24gZnJvbSBcIi4uL2ltYWdlcy9wZW5jaWwuc3ZnXCI7XG5pbXBvcnQgaGVhZGVyTG9nbyBmcm9tIFwiLi4vaW1hZ2VzL2xvZ28uc3ZnXCI7XG5pbXBvcnQgY2xvc2VCdXR0b24gZnJvbSBcIi4uL2ltYWdlcy94LnN2Z1wiO1xuaW1wb3J0IEFwaSBmcm9tIFwiLi4vdXRpbHMvQXBpLmpzXCI7XG5pbXBvcnQgeyBzZXRCdXR0b25UZXh0IH0gZnJvbSBcIi4uL3V0aWxzL2hlbHBlcnMuanNcIjtcblxuY29uc3QgcHJvZmlsZUF2YXRhciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicHJvZmlsZS1hdmF0YXJcIik7XG5wcm9maWxlQXZhdGFyLnNyYyA9IGF2YXRhclNyYztcblxuY29uc3QgYWRkQ2FyZENsb3NlQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJhZGQtY2FyZC1jbG9zZS1idG5cIik7XG5hZGRDYXJkQ2xvc2VCdG4uc3JjID0gY2xvc2VCdXR0b247XG5cbmNvbnN0IGVkaXRDYXJkQ2xvc2VCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImVkaXQtY2FyZC1jbG9zZS1idG5cIik7XG5lZGl0Q2FyZENsb3NlQnRuLnNyYyA9IGNsb3NlQnV0dG9uO1xuXG5jb25zdCBwZW5jaWxJbWcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInBlbmNpbC1pY29uXCIpO1xucGVuY2lsSW1nLnNyYyA9IHBlbmNpbEljb247XG5cbmNvbnN0IHBsdXNJbWcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInBsdXMtaWNvblwiKTtcbnBsdXNJbWcuc3JjID0gcGx1c0ljb247XG5cbmNvbnN0IGhlYWRlckltZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiaGVhZGVyLWxvZ29cIik7XG5oZWFkZXJJbWcuc3JjID0gaGVhZGVyTG9nbztcblxuaW1wb3J0IHtcbiAgZW5hYmxlVmFsaWRhdGlvbixcbiAgdmFsaWRhdGlvbkNvbmZpZyxcbiAgcmVzZXRWYWxpZGF0aW9uLFxuICBkaXNhYmxlQnV0dG9uLFxufSBmcm9tIFwiLi4vc2NyaXB0cy92YWxpZGF0aW9uLmpzXCI7XG5cbi8vIGNvbnN0IGluaXRpYWxDYXJkcyA9IFtcbi8vICAge1xuLy8gICAgIG5hbWU6IFwiVmFsIFRob3JlbnNcIixcbi8vICAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvMS1waG90by1ieS1tb3JpdHotZmVsZG1hbm4tZnJvbS1wZXhlbHMuanBnXCIsXG4vLyAgIH0sXG4vLyAgIHtcbi8vICAgICBuYW1lOiBcIlJlc3RhdXJhbnQgdGVycmFjZVwiLFxuLy8gICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9zcG90cy8yLXBob3RvLWJ5LWNlaWxpbmUtZnJvbS1wZXhlbHMuanBnXCIsXG4vLyAgIH0sXG4vLyAgIHtcbi8vICAgICBuYW1lOiBcIkFuIG91dGRvb3IgY2FmZVwiLFxuLy8gICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9zcG90cy8zLXBob3RvLWJ5LXR1YmFudXItZG9nYW4tZnJvbS1wZXhlbHMuanBnXCIsXG4vLyAgIH0sXG4vLyAgIHtcbi8vICAgICBuYW1lOiBcIkEgdmVyeSBsb25nIGJyaWRnZSwgb3ZlciB0aGUgZm9yZXN0IGFuZCB0aHJvdWdoIHRoZSB0cmVlc1wiLFxuLy8gICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9zcG90cy80LXBob3RvLWJ5LW1hdXJpY2UtbGFzY2hldC1mcm9tLXBleGVscy5qcGdcIixcbi8vICAgfSxcbi8vICAge1xuLy8gICAgIG5hbWU6IFwiVHVubmVsIHdpdGggbW9ybmluZyBsaWdodFwiLFxuLy8gICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9zcG90cy81LXBob3RvLWJ5LXZhbi1hbmgtbmd1eWVuLWZyb20tcGV4ZWxzLmpwZ1wiLFxuLy8gICB9LFxuLy8gICB7XG4vLyAgICAgbmFtZTogXCJNb3VudGFpbiBob3VzZVwiLFxuLy8gICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9zcG90cy82LXBob3RvLWJ5LW1vcml0ei1mZWxkbWFubi1mcm9tLXBleGVscy5qcGdcIixcbi8vICAgfSxcbi8vICAge1xuLy8gICAgIG5hbWU6IFwiR29sZGVuIEdhdGUgYnJpZGdlXCIsXG4vLyAgICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzctcGhvdG8tYnktZ3JpZmZpbi13b29sZHJpZGdlLWZyb20tcGV4ZWxzLmpwZ1wiLFxuLy8gICB9LFxuLy8gXTtcblxuY29uc3QgYXBpID0gbmV3IEFwaSh7XG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQtYXBpLmVuLnRyaXBsZXRlbi1zZXJ2aWNlcy5jb20vdjFcIixcbiAgaGVhZGVyczoge1xuICAgIGF1dGhvcml6YXRpb246IFwiMjI5ZmU3ZjUtMWRkNS00YjM3LTk3NDYtYzAwODE0MDRlMmE3XCIsXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gIH0sXG59KTtcblxubGV0IGN1cnJlbnRVc2VySWQgPSBcIlwiO1xuXG4vLyBkZXN0cnVjdHVyZSB0aGUgc2Vjb25kIGl0ZW0gaW4gdGhlIGNhbGxiYWNrIG9mIHRoZSAudGhlbigpXG5hcGlcbiAgLmdldEFwcEluZm8oKVxuICAudGhlbigoW2NhcmRzLCB1c2VySW5mb10pID0+IHtcbiAgICBjdXJyZW50VXNlcklkID0gdXNlckluZm8uX2lkO1xuXG4gICAgY2FyZHMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBnZXRDYXJkRWxlbWVudChpdGVtKTtcbiAgICAgIGNhcmRzTGlzdC5hcHBlbmQoY2FyZEVsZW1lbnQpO1xuICAgIH0pO1xuXG4gICAgcHJvZmlsZUF2YXRhci5zcmMgPSB1c2VySW5mby5hdmF0YXI7XG4gICAgcHJvZmlsZU5hbWUudGV4dENvbnRlbnQgPSB1c2VySW5mby5uYW1lO1xuICAgIHByb2ZpbGVEZXNjcmlwdGlvbi50ZXh0Q29udGVudCA9IHVzZXJJbmZvLmFib3V0O1xuICB9KVxuICAuY2F0Y2goY29uc29sZS5lcnJvcik7XG5cbi8vIFByb2ZpbGUgRWxlbWVudHNcbmNvbnN0IHByb2ZpbGVFZGl0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0LWJ0blwiKTtcbmNvbnN0IGNhcmRNb2RhbEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYWRkLWJ0blwiKTtcbmNvbnN0IGF2YXRhck1vZGFsQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXItYnRuXCIpO1xuY29uc3QgcHJvZmlsZU5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX25hbWVcIik7XG5jb25zdCBwcm9maWxlRGVzY3JpcHRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2Rlc2NyaXB0aW9uXCIpO1xuXG4vLyBFZGl0IEZvcm0gTW9kYWxzXG5jb25zdCBlZGl0TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2VkaXQtbW9kYWxcIik7XG5jb25zdCBlZGl0Rm9ybUVsZW1lbnQgPSBlZGl0TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcbmNvbnN0IGVkaXRDbG9zZU1vZGFsQnRuID0gZWRpdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlLWJ0blwiKTtcbmNvbnN0IGVkaXRNb2RhbE5hbWVJbnB1dCA9IGVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtbmFtZS1pbnB1dFwiKTtcbmNvbnN0IGVkaXRNb2RhbERlc2NyaXB0aW9uSW5wdXQgPSBlZGl0TW9kYWwucXVlcnlTZWxlY3RvcihcbiAgXCIjcHJvZmlsZS1kZXNjcmlwdGlvbi1pbnB1dFwiXG4pO1xuY29uc3QgcHJldmlld01vZGFsQ2xvc2VCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICBcIi5tb2RhbF9fY2xvc2UtYnRuX3R5cGVfcHJldmlld1wiXG4pO1xuXG4vLyBDYXJkIEZvcm0gRWxlbWVudHNcbmNvbnN0IGNhcmRNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYWRkLWNhcmQtbW9kYWxcIik7XG5jb25zdCBjYXJkRm9ybSA9IGNhcmRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xuY29uc3QgY2FyZFN1Ym1pdEJ0biA9IGNhcmRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19zdWJtaXQtYnRuXCIpO1xuY29uc3QgY2FyZE1vZGFsQ2xvc2VCdG4gPSBjYXJkTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2UtYnRuXCIpO1xuY29uc3QgY2FyZE5hbWVJbnB1dCA9IGNhcmRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI2FkZC1jYXJkLW5hbWUtaW5wdXRcIik7XG5jb25zdCBjYXJkTGlua0lucHV0ID0gY2FyZE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjYWRkLWNhcmQtbGluay1pbnB1dFwiKTtcblxuLy8gQXZhdGFyIEZvcm0gRWxlbWVudHNcbmNvbnN0IGF2YXRhck1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNhdmF0YXItbW9kYWxcIik7XG5jb25zdCBhdmF0YXJGb3JtID0gYXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcbmNvbnN0IGF2YXRhclN1Ym1pdEJ0biA9IGF2YXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3N1Ym1pdC1idG5cIik7XG5jb25zdCBhdmF0YXJNb2RhbENsb3NlQnRuID0gYXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2UtYnRuXCIpO1xuY29uc3QgYXZhdGFySW5wdXQgPSBhdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtYXZhdGFyLWlucHV0XCIpO1xuXG4vLyBEZWxldGUgRm9ybSBFbGVtZW50c1xuY29uc3QgZGVsZXRlTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2RlbGV0ZS1tb2RhbFwiKTtcbmNvbnN0IGRlbGV0ZUZvcm0gPSBkZWxldGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI2RlbGV0ZS1mb3JtXCIpO1xuY29uc3QgZGVsZXRlQ2FuY2VsQnRuID0gZGVsZXRlTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2FuY2VsLWJ0blwiKTtcblxuLy8gUHJldmlldyBJbWFnZSBQb3B1cCBlbGVtZW50c1xuY29uc3QgcHJldmlld01vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcmV2aWV3LW1vZGFsXCIpO1xuY29uc3QgcHJldmlld01vZGFsSW1hZ2VFbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2ltYWdlXCIpO1xuY29uc3QgcHJldmlld01vZGFsQ2FwdGlvbkVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2FwdGlvblwiKTtcblxuLy8gQ2FyZCBSZWxhdGVkIEVsZW1lbnRzXG5jb25zdCBjYXJkVGVtcGxhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtdGVtcGxhdGVcIik7XG5jb25zdCBjYXJkc0xpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRzX19saXN0XCIpO1xuXG5sZXQgc2VsZWN0ZWRDYXJkLCBzZWxlY3RlZENhcmRJZDtcblxuZnVuY3Rpb24gaGFuZGxlTGlrZShldnQsIGlkKSB7XG4gIGNvbnN0IGxpa2VCdXR0b24gPSBldnQudGFyZ2V0O1xuXG4gIGNvbnN0IGlzTGlrZWQgPSBsaWtlQnV0dG9uLmNsYXNzTGlzdC5jb250YWlucyhcImNhcmRfX2xpa2UtYnRuX2xpa2VkXCIpO1xuXG4gIGFwaVxuICAgIC5jaGFuZ2VMaWtlU3RhdHVzKGlkLCBpc0xpa2VkKVxuICAgIC50aGVuKCh1cGRhdGVkQ2FyZCkgPT4ge1xuICAgICAgaWYgKHVwZGF0ZWRDYXJkLmlzTGlrZWQpIHtcbiAgICAgICAgbGlrZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwiY2FyZF9fbGlrZS1idG5fbGlrZWRcIik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsaWtlQnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoXCJjYXJkX19saWtlLWJ0bl9saWtlZFwiKTtcbiAgICAgIH1cbiAgICB9KVxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKTtcbn1cblxuZnVuY3Rpb24gZ2V0Q2FyZEVsZW1lbnQoZGF0YSkge1xuICBjb25zdCBjYXJkRWxlbWVudCA9IGNhcmRUZW1wbGF0ZS5jb250ZW50XG4gICAgLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZFwiKVxuICAgIC5jbG9uZU5vZGUodHJ1ZSk7XG5cbiAgY29uc3QgY2FyZE5hbWVFbCA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fdGl0bGVcIik7XG4gIGNvbnN0IGNhcmRJbWFnZUVsID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19pbWFnZVwiKTtcbiAgY29uc3QgY2FyZExpa2VCdG4gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnRuXCIpO1xuICBjb25zdCBjYXJkRGVsZXRlQnRuID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19kZWxldGUtYnRuXCIpO1xuXG4gIGlmIChkYXRhLmlzTGlrZWQpIHtcbiAgICBjYXJkTGlrZUJ0bi5jbGFzc0xpc3QuYWRkKFwiY2FyZF9fbGlrZS1idG5fbGlrZWRcIik7XG4gIH1cblxuICBjYXJkTmFtZUVsLnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xuICBjYXJkSW1hZ2VFbC5zcmMgPSBkYXRhLmxpbms7XG4gIGNhcmRJbWFnZUVsLmFsdCA9IGRhdGEubmFtZTtcblxuICBjYXJkTGlrZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2dCkgPT4gaGFuZGxlTGlrZShldnQsIGRhdGEuX2lkKSk7XG5cbiAgY2FyZEltYWdlRWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICBvcGVuTW9kYWwocHJldmlld01vZGFsKTtcbiAgICBwcmV2aWV3TW9kYWxJbWFnZUVsLnNyYyA9IGRhdGEubGluaztcbiAgICBwcmV2aWV3TW9kYWxDYXB0aW9uRWwudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XG4gIH0pO1xuXG4gIGNhcmREZWxldGVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICBoYW5kbGVEZWxldGVDYXJkKGNhcmRFbGVtZW50LCBkYXRhLl9pZCk7XG4gIH0pO1xuXG4gIHJldHVybiBjYXJkRWxlbWVudDtcbn1cblxuZnVuY3Rpb24gb3Blbk1vZGFsKG1vZGFsKSB7XG4gIG1vZGFsLmNsYXNzTGlzdC5hZGQoXCJtb2RhbF9vcGVuZWRcIik7XG4gIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZChcIm1vZGFsLW9wZW5cIik7XG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGhhbmRsZUVzY0Nsb3NlKTtcbn1cblxuZnVuY3Rpb24gY2xvc2VNb2RhbChtb2RhbCkge1xuICBtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKFwibW9kYWxfb3BlbmVkXCIpO1xuICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5yZW1vdmUoXCJtb2RhbC1vcGVuXCIpO1xuICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBoYW5kbGVFc2NDbG9zZSk7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZUVkaXRGb3JtU3VibWl0KGV2dCkge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcblxuICBjb25zdCBzdWJtaXRCdG4gPSBldnQuc3VibWl0dGVyO1xuXG4gIHNldEJ1dHRvblRleHQoc3VibWl0QnRuLCB0cnVlKTtcblxuICBhcGlcbiAgICAuZWRpdFVzZXJJbmZvKHtcbiAgICAgIG5hbWU6IGVkaXRNb2RhbE5hbWVJbnB1dC52YWx1ZSxcbiAgICAgIGFib3V0OiBlZGl0TW9kYWxEZXNjcmlwdGlvbklucHV0LnZhbHVlLFxuICAgIH0pXG4gICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgIHByb2ZpbGVOYW1lLnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xuICAgICAgcHJvZmlsZURlc2NyaXB0aW9uLnRleHRDb250ZW50ID0gZGF0YS5hYm91dDtcbiAgICAgIGNsb3NlTW9kYWwoZWRpdE1vZGFsKTtcbiAgICB9KVxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHNldEJ1dHRvblRleHQoc3VibWl0QnRuLCBmYWxzZSk7XG4gICAgfSk7XG59XG5cbi8vIFRPRE9EIC0gSW1wbGVtZW50IGxvYWRpbmcgdGV4dCBmb3IgYWxsIG90aGVyIGZvcm0gc3VibWlzc2lvbnNcblxuZnVuY3Rpb24gaGFuZGxlRGVsZXRlQ2FyZChjYXJkRWxlbWVudCwgY2FyZElkKSB7XG4gIHNlbGVjdGVkQ2FyZCA9IGNhcmRFbGVtZW50O1xuICBzZWxlY3RlZENhcmRJZCA9IGNhcmRJZDtcbiAgb3Blbk1vZGFsKGRlbGV0ZU1vZGFsKTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlRGVsZXRlU3VibWl0KGV2dCkge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcblxuICBjb25zdCBzdWJtaXRCdG4gPSBldnQuc3VibWl0dGVyO1xuICBzZXRCdXR0b25UZXh0KHN1Ym1pdEJ0biwgdHJ1ZSwgXCJEZWxldGVcIiwgXCJEZWxldGluZy4uLlwiKTtcblxuICBhcGlcbiAgICAuZGVsZXRlQ2FyZChzZWxlY3RlZENhcmRJZClcbiAgICAudGhlbigoKSA9PiB7XG4gICAgICBzZWxlY3RlZENhcmQucmVtb3ZlKCk7XG4gICAgICBjbG9zZU1vZGFsKGRlbGV0ZU1vZGFsKTtcbiAgICB9KVxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHNldEJ1dHRvblRleHQoc3VibWl0QnRuLCBmYWxzZSwgXCJEZWxldGVcIiwgXCJEZWxldGluZy4uLlwiKTtcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlQWRkQ2FyZFN1Ym1pdChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgY29uc3Qgc3VibWl0QnRuID0gZXZ0LnN1Ym1pdHRlcjtcbiAgc2V0QnV0dG9uVGV4dChzdWJtaXRCdG4sIHRydWUpO1xuXG4gIGNvbnN0IG5hbWUgPSBjYXJkTmFtZUlucHV0LnZhbHVlO1xuICBjb25zdCBsaW5rID0gY2FyZExpbmtJbnB1dC52YWx1ZTtcblxuICBhcGlcbiAgICAuYWRkTmV3Q2FyZCh7IG5hbWUsIGxpbmsgfSlcbiAgICAudGhlbigobmV3Q2FyZCkgPT4ge1xuICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBnZXRDYXJkRWxlbWVudChuZXdDYXJkKTtcbiAgICAgIGNhcmRzTGlzdC5wcmVwZW5kKGNhcmRFbGVtZW50KTtcbiAgICAgIGNhcmRGb3JtLnJlc2V0KCk7XG4gICAgICBkaXNhYmxlQnV0dG9uKGNhcmRTdWJtaXRCdG4sIHZhbGlkYXRpb25Db25maWcpO1xuICAgICAgY2xvc2VNb2RhbChjYXJkTW9kYWwpO1xuICAgIH0pXG4gICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgc2V0QnV0dG9uVGV4dChzdWJtaXRCdG4sIGZhbHNlKTtcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlQXZhdGFyRm9ybVN1Ym1pdChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgY29uc3Qgc3VibWl0QnRuID0gZXZ0LnN1Ym1pdHRlcjtcbiAgc2V0QnV0dG9uVGV4dChzdWJtaXRCdG4sIHRydWUpO1xuXG4gIGFwaVxuICAgIC51cGRhdGVBdmF0YXIoeyBhdmF0YXI6IGF2YXRhcklucHV0LnZhbHVlIH0pXG4gICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgIHByb2ZpbGVBdmF0YXIuc3JjID0gZGF0YS5hdmF0YXI7XG4gICAgICBldnQudGFyZ2V0LnJlc2V0KCk7XG4gICAgICBkaXNhYmxlQnV0dG9uKGF2YXRhclN1Ym1pdEJ0biwgdmFsaWRhdGlvbkNvbmZpZyk7XG4gICAgICBjbG9zZU1vZGFsKGF2YXRhck1vZGFsKTtcbiAgICB9KVxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHNldEJ1dHRvblRleHQoc3VibWl0QnRuLCBmYWxzZSk7XG4gICAgfSk7XG59XG5cbnByb2ZpbGVFZGl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIGVkaXRNb2RhbE5hbWVJbnB1dC52YWx1ZSA9IHByb2ZpbGVOYW1lLnRleHRDb250ZW50O1xuICBlZGl0TW9kYWxEZXNjcmlwdGlvbklucHV0LnZhbHVlID0gcHJvZmlsZURlc2NyaXB0aW9uLnRleHRDb250ZW50O1xuICByZXNldFZhbGlkYXRpb24oXG4gICAgZWRpdEZvcm1FbGVtZW50LFxuICAgIFtlZGl0TW9kYWxOYW1lSW5wdXQsIGVkaXRNb2RhbERlc2NyaXB0aW9uSW5wdXRdLFxuICAgIHZhbGlkYXRpb25Db25maWdcbiAgKTtcbiAgb3Blbk1vZGFsKGVkaXRNb2RhbCk7XG59KTtcblxuY2FyZE1vZGFsQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIHJlc2V0VmFsaWRhdGlvbihjYXJkRm9ybSwgW2NhcmROYW1lSW5wdXQsIGNhcmRMaW5rSW5wdXRdLCB2YWxpZGF0aW9uQ29uZmlnKTtcbiAgb3Blbk1vZGFsKGNhcmRNb2RhbCk7XG59KTtcblxuZGVsZXRlQ2FuY2VsQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIGNsb3NlTW9kYWwoZGVsZXRlTW9kYWwpO1xufSk7XG5cbmVkaXRDbG9zZU1vZGFsQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIGNsb3NlTW9kYWwoZWRpdE1vZGFsKTtcbn0pO1xuXG5wcmV2aWV3TW9kYWxDbG9zZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBjbG9zZU1vZGFsKHByZXZpZXdNb2RhbCk7XG59KTtcblxuY2FyZE1vZGFsQ2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgY2xvc2VNb2RhbChjYXJkTW9kYWwpO1xufSk7XG5cbmF2YXRhck1vZGFsQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIG9wZW5Nb2RhbChhdmF0YXJNb2RhbCk7XG59KTtcblxuYXZhdGFyTW9kYWxDbG9zZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICByZXNldFZhbGlkYXRpb24oYXZhdGFyRm9ybSwgW2F2YXRhcklucHV0XSwgdmFsaWRhdGlvbkNvbmZpZyk7XG4gIGNsb3NlTW9kYWwoYXZhdGFyTW9kYWwpO1xufSk7XG5cbmF2YXRhckZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVBdmF0YXJGb3JtU3VibWl0KTtcblxuZGVsZXRlRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZURlbGV0ZVN1Ym1pdCk7XG5cbmVkaXRGb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUVkaXRGb3JtU3VibWl0KTtcbmNhcmRGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlQWRkQ2FyZFN1Ym1pdCk7XG5cbmNvbnN0IGV4aXN0TW9kYWxzT3ZlcmxheSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIubW9kYWxcIik7XG5cbmV4aXN0TW9kYWxzT3ZlcmxheS5mb3JFYWNoKChtb2RhbCkgPT4ge1xuICBtb2RhbC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIChldnQpID0+IHtcbiAgICBpZiAoZXZ0LnRhcmdldCA9PT0gbW9kYWwpIHtcbiAgICAgIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoXCJtb2RhbF9vcGVuZWRcIik7XG4gICAgICBjbG9zZU1vZGFsKG1vZGFsKTtcbiAgICB9XG4gIH0pO1xufSk7XG5cbmZ1bmN0aW9uIGhhbmRsZUVzY0Nsb3NlKGV2dCkge1xuICBpZiAoZXZ0LmtleSA9PT0gXCJFc2NhcGVcIikge1xuICAgIGNvbnN0IG9wZW5Nb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWwubW9kYWxfb3BlbmVkXCIpO1xuICAgIGlmIChvcGVuTW9kYWwpIHtcbiAgICAgIGNsb3NlTW9kYWwob3Blbk1vZGFsKTtcbiAgICB9XG4gIH1cbn1cblxuZW5hYmxlVmFsaWRhdGlvbih2YWxpZGF0aW9uQ29uZmlnKTtcbiIsImNsYXNzIEFwaSB7XG4gIGNvbnN0cnVjdG9yKHsgYmFzZVVybCwgaGVhZGVycyB9KSB7XG4gICAgdGhpcy5fYmFzZVVybCA9IGJhc2VVcmw7XG4gICAgdGhpcy5faGVhZGVycyA9IGhlYWRlcnM7XG4gIH1cblxuICBnZXRBcHBJbmZvKCkge1xuICAgIC8vIGNhbGwgZ2V0VXNlckluZm8gaW4gdGhpcyBhcnJheVxuICAgIHJldHVybiBQcm9taXNlLmFsbChbdGhpcy5nZXRJbml0aWFsQ2FyZHMoKSwgdGhpcy5nZXRVc2VySW5mbygpXSk7XG4gIH1cblxuICBnZXRJbml0aWFsQ2FyZHMoKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG4gICAgICBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vIHRvZG8gLSAgaW1wbGVtZW50IFBPU1QgL2NhcmRzXG4gIGFkZE5ld0NhcmQoeyBuYW1lLCBsaW5rIH0pIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgbmFtZSwgbGluayB9KSxcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgX2NoZWNrUmVzcG9uc2UocmVzKSB7XG4gICAgaWYgKHJlcy5vaykge1xuICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgfVxuICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgfVxuXG4gIGdldFVzZXJJbmZvKCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICBpZiAocmVzLm9rKSB7XG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICAgIH0pO1xuICB9XG5cbiAgdXBkYXRlQXZhdGFyKGRhdGEpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoZGF0YSksXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxuXG4gIGVkaXRVc2VySW5mbyh7IG5hbWUsIGFib3V0IH0pIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IG5hbWUsIGFib3V0IH0pLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9KTtcbiAgfVxuXG4gIGRlbGV0ZUNhcmQoaWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtpZH1gLCB7XG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9KTtcbiAgfVxuXG4gIGNoYW5nZUxpa2VTdGF0dXMoaWQsIGlzTGlrZWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtpZH0vbGlrZXNgLCB7XG4gICAgICBtZXRob2Q6IGlzTGlrZWQgPyBcIkRFTEVURVwiIDogXCJQVVRcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICBpZiAocmVzLm9rKSB7XG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICAgIH0pO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEFwaTtcbiJdLCJuYW1lcyI6WyJfX3dlYnBhY2tfcmVxdWlyZV9fIiwic2V0QnV0dG9uVGV4dCIsImJ0biIsImlzTG9hZGluZyIsImRlZmF1bHRUZXh0IiwibG9hZGluZ1RleHQiLCJ0ZXh0Q29udGVudCIsInZhbGlkYXRpb25Db25maWciLCJmb3JtU2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsImhpZGVJbnB1dEVycm9yIiwiZm9ybUVsIiwiaW5wdXRFbCIsImNvbmZpZyIsInF1ZXJ5U2VsZWN0b3IiLCJpZCIsImNsYXNzTGlzdCIsInJlbW92ZSIsInRvZ2dsZUJ1dHRvblN0YXRlIiwiaW5wdXRMaXN0IiwiYnV0dG9uRWwiLCJzb21lIiwiaW5wdXQiLCJ2YWxpZGl0eSIsInZhbGlkIiwiaGFzSW52YWxpZElucHV0IiwiZGlzYWJsZUJ1dHRvbiIsImRpc2FibGVkIiwiYWRkIiwicmVzZXRWYWxpZGF0aW9uIiwiZm9yRWFjaCIsInByb2ZpbGVBdmF0YXIiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwic3JjIiwiYXZhdGFyU3JjIiwiY2xvc2VCdXR0b24iLCJwZW5jaWxJY29uIiwicGx1c0ljb24iLCJoZWFkZXJMb2dvIiwiYXBpIiwiY29uc3RydWN0b3IiLCJiYXNlVXJsIiwiaGVhZGVycyIsInRoaXMiLCJfYmFzZVVybCIsIl9oZWFkZXJzIiwiZ2V0QXBwSW5mbyIsIlByb21pc2UiLCJhbGwiLCJnZXRJbml0aWFsQ2FyZHMiLCJnZXRVc2VySW5mbyIsImZldGNoIiwidGhlbiIsInJlcyIsIm9rIiwianNvbiIsInJlamVjdCIsInN0YXR1cyIsImFkZE5ld0NhcmQiLCJuYW1lIiwibGluayIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiX2NoZWNrUmVzcG9uc2UiLCJ1cGRhdGVBdmF0YXIiLCJkYXRhIiwiZWRpdFVzZXJJbmZvIiwiYWJvdXQiLCJkZWxldGVDYXJkIiwiY2hhbmdlTGlrZVN0YXR1cyIsImlzTGlrZWQiLCJhdXRob3JpemF0aW9uIiwiY3VycmVudFVzZXJJZCIsImNhcmRzIiwidXNlckluZm8iLCJfaWQiLCJpdGVtIiwiY2FyZEVsZW1lbnQiLCJnZXRDYXJkRWxlbWVudCIsImNhcmRzTGlzdCIsImFwcGVuZCIsImF2YXRhciIsInByb2ZpbGVOYW1lIiwicHJvZmlsZURlc2NyaXB0aW9uIiwiY2F0Y2giLCJjb25zb2xlIiwiZXJyb3IiLCJwcm9maWxlRWRpdEJ1dHRvbiIsImNhcmRNb2RhbEJ0biIsImF2YXRhck1vZGFsQnRuIiwiZWRpdE1vZGFsIiwiZWRpdEZvcm1FbGVtZW50IiwiZWRpdENsb3NlTW9kYWxCdG4iLCJlZGl0TW9kYWxOYW1lSW5wdXQiLCJlZGl0TW9kYWxEZXNjcmlwdGlvbklucHV0IiwicHJldmlld01vZGFsQ2xvc2VCdG4iLCJjYXJkTW9kYWwiLCJjYXJkRm9ybSIsImNhcmRTdWJtaXRCdG4iLCJjYXJkTW9kYWxDbG9zZUJ0biIsImNhcmROYW1lSW5wdXQiLCJjYXJkTGlua0lucHV0IiwiYXZhdGFyTW9kYWwiLCJhdmF0YXJGb3JtIiwiYXZhdGFyU3VibWl0QnRuIiwiYXZhdGFyTW9kYWxDbG9zZUJ0biIsImF2YXRhcklucHV0IiwiZGVsZXRlTW9kYWwiLCJkZWxldGVGb3JtIiwiZGVsZXRlQ2FuY2VsQnRuIiwicHJldmlld01vZGFsIiwicHJldmlld01vZGFsSW1hZ2VFbCIsInByZXZpZXdNb2RhbENhcHRpb25FbCIsImNhcmRUZW1wbGF0ZSIsInNlbGVjdGVkQ2FyZCIsInNlbGVjdGVkQ2FyZElkIiwiY29udGVudCIsImNsb25lTm9kZSIsImNhcmROYW1lRWwiLCJjYXJkSW1hZ2VFbCIsImNhcmRMaWtlQnRuIiwiY2FyZERlbGV0ZUJ0biIsImFsdCIsImFkZEV2ZW50TGlzdGVuZXIiLCJldnQiLCJsaWtlQnV0dG9uIiwidGFyZ2V0IiwiY29udGFpbnMiLCJ1cGRhdGVkQ2FyZCIsImhhbmRsZUxpa2UiLCJvcGVuTW9kYWwiLCJjYXJkSWQiLCJoYW5kbGVEZWxldGVDYXJkIiwibW9kYWwiLCJoYW5kbGVFc2NDbG9zZSIsImNsb3NlTW9kYWwiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwia2V5IiwidmFsdWUiLCJwcmV2ZW50RGVmYXVsdCIsInN1Ym1pdEJ0biIsInN1Ym1pdHRlciIsInJlc2V0IiwiZmluYWxseSIsIm5ld0NhcmQiLCJwcmVwZW5kIiwicXVlcnlTZWxlY3RvckFsbCIsInNldEV2ZW50TGlzdGVuZXJzIiwiQXJyYXkiLCJmcm9tIiwiYnV0dG9uRWxlbWVudCIsImlucHV0RWxlbWVudCIsImNoZWNrSW5wdXRWYWxpZGl0eSIsInNob3dJbnB1dEVycm9yIiwiZXJyb3JNc2ciLCJ2YWxpZGF0aW9uTWVzc2FnZSJdLCJzb3VyY2VSb290IjoiIn0=